<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IESV House Finder</title>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, sans-serif;
    }

    body {
        background: url("stone.png") center/cover no-repeat fixed;
        min-height: 100vh;
        padding: 20px;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1 {
        margin-top: 10px;
        margin-bottom: 20px;
        font-size: 26px;
        text-shadow: 0 0 6px black;
        text-align: center;
    }

    .search-box {
        width: 100%;
        max-width: 420px;
        background: rgba(0,0,0,0.55);
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0,0,0,0.6);
    }

    input {
        width: 100%;
        padding: 14px;
        font-size: 18px;
        border-radius: 10px;
        border: none;
        outline: none;
        margin-bottom: 10px;
    }

    #status {
        text-align: center;
        margin-top: 4px;
        font-size: 14px;
        opacity: 0.8;
    }

    #result {
        margin-top: 18px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        min-height: 140px;
    }

    .shield {
        width: 140px;
        height: auto;
        margin: 10px auto;
        display: block;
        opacity: 0;
        transform: scale(0.8);
        transition: 0.25s ease;
    }

    .shield.show {
        opacity: 1;
        transform: scale(1.0);
        filter: drop-shadow(0 0 12px rgba(255,255,255,0.6));
    }

    #nameDisplay {
        margin-top: 12px;
        font-size: 22px;
        text-shadow: 0 0 6px black;
    }

    #houseDisplay {
        margin-top: 6px;
        font-size: 26px;
        text-shadow: 0 0 10px black;
    }
</style>

</head>
<body>

<h1>üîç Check a Student's House</h1>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="Start typing a student's name...">
    <div id="status">Loading roster...</div>
</div>

<div id="result">
    <img id="shield" class="shield" src="">
    <div id="nameDisplay"></div>
    <div id="houseDisplay"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec";

let allStudents = [];
let loaded = false;

async function loadStudents() {
    const status = document.getElementById("status");

    try {
        status.textContent = "Loading roster...";

        const res = await fetch(SCRIPT_URL + "?action=houseLookup");
        const data = await res.json();

        if (data.status !== "ok") {
            status.textContent = "Error loading roster.";
            return;
        }

        allStudents = data.students;
        loaded = true;
        status.textContent = "Ready.";
    } 
    catch (err) {
        status.textContent = "Server unreachable.";
        console.error(err);
    }
}

loadStudents();

const input = document.getElementById("searchInput");
const shieldImg = document.getElementById("shield");
const nameDisplay = document.getElementById("nameDisplay");
const houseDisplay = document.getElementById("houseDisplay");

const houseShields = {
    "Dragon": "dragon2-removebg.png",
    "Griffin": "griffin2-removebg.png",
    "Phoenix": "phoenix2-removebg.png",
    "Hydra": "hydra2-removebg.png"
};

input.addEventListener("input", () => {
    if (!loaded) return;

    const q = input.value.trim().toLowerCase();

    if (q.length < 2) {
        nameDisplay.textContent = "";
        houseDisplay.textContent = "";
        shieldImg.classList.remove("show");
        return;
    }

    const match = allStudents.find(s =>
        (s.fullName || "").toLowerCase().includes(q)
    );

    if (!match) {
        nameDisplay.textContent = "No match";
        houseDisplay.textContent = "";
        shieldImg.classList.remove("show");
        return;
    }

    nameDisplay.textContent = match.fullName;
    houseDisplay.textContent = match.house ? "House " + match.house : "";

    if (match.house && houseShields[match.house]) {
        shieldImg.src = houseShields[match.house];
        shieldImg.classList.add("show");
    } else {
        shieldImg.classList.remove("show");
    }
});
</script>

</body>
</html>
