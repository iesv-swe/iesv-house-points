<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Display</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: url('stone.png') repeat;
    background-size: 600px;
    min-height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    position: relative;
}

/* Floating particles */
.particles {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
}

.particle {
    position: absolute;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    animation: float 8s infinite ease-in-out;
}

@keyframes float {
    0% { transform: translateY(0); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translateY(-120vh); opacity: 0; }
}

/* House-specific particle colors */
body.phoenix .particle { background: rgba(255, 68, 68, 0.85); }
body.dragon .particle { background: rgba(68, 170, 68, 0.85); }
body.hydra .particle { background: rgba(68, 136, 255, 0.85); }
body.griffin .particle { background: rgba(255, 170, 0, 0.85); }

/* Main container */
.display-container {
    width: 90%;
    max-width: 800px;
    z-index: 5;
    text-align: center;
}

/* House crest with glow */
.house-crest-container {
    position: relative;
    margin-bottom: 30px;
    animation: floatCrest 4s ease-in-out infinite;
}

@keyframes floatCrest {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
}

.crest-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 400px;
    height: 400px;
    border-radius: 50%;
    filter: blur(60px);
    opacity: 0.4;
    z-index: -1;
    animation: glowPulse 3s ease-in-out infinite;
}

@keyframes glowPulse {
    0%, 100% { opacity: 0.4; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.1); }
}

body.phoenix .crest-glow { background: #ff4444; }
body.dragon .crest-glow { background: #44aa44; }
body.hydra .crest-glow { background: #4488ff; }
body.griffin .crest-glow { background: #ffaa00; }

.house-crest {
    width: 300px;
    height: 300px;
    filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.6));
}

/* House name */
.house-name {
    font-size: 72px;
    font-weight: 900;
    margin-bottom: 20px;
    text-shadow: 0 8px 20px rgba(0, 0, 0, 0.9);
    letter-spacing: 4px;
}

body.phoenix .house-name { color: #ff4444; text-shadow: 0 0 20px #ff4444, 0 0 40px #ff4444; }
body.dragon .house-name { color: #44aa44; text-shadow: 0 0 20px #44aa44, 0 0 40px #44aa44; }
body.hydra .house-name { color: #4488ff; text-shadow: 0 0 20px #4488ff, 0 0 40px #4488ff; }
body.griffin .house-name { color: #ffaa00; text-shadow: 0 0 20px #ffaa00, 0 0 40px #ffaa00; }

/* Stats card */
.stats-card {
    background: rgba(0, 0, 0, 0.7);
    border-radius: 30px;
    padding: 40px;
    margin-bottom: 30px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
    border: 3px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

/* Animated border glow */
.stats-card::before {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 30px;
    padding: 3px;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: borderRotate 3s linear infinite;
}

@keyframes borderRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.stat-item {
    text-align: center;
}

.stat-label {
    font-size: 18px;
    text-transform: uppercase;
    letter-spacing: 2px;
    opacity: 0.9;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 96px;
    font-weight: 900;
    line-height: 1;
    text-shadow: 0 0 30px currentColor;
    animation: statPulse 2s ease-in-out infinite;
}

@keyframes statPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

body.phoenix .stat-value { color: #ff4444; }
body.dragon .stat-value { color: #44aa44; }
body.hydra .stat-value { color: #4488ff; }
body.griffin .stat-value { color: #ffaa00; }

.rank-badge {
    display: inline-block;
    padding: 10px 30px;
    border-radius: 50px;
    font-size: 32px;
    font-weight: 700;
    margin-top: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}

.rank-1 { background: linear-gradient(135deg, #ffd700, #ffae00); color: black; }
.rank-2 { background: linear-gradient(135deg, #d4d4d4, #f7f7f7); color: black; }
.rank-3 { background: linear-gradient(135deg, #cd7f32, #e2a46e); color: black; }
.rank-4 { background: linear-gradient(135deg, #666, #888); color: white; }

/* Secret message box */
.secret-message {
    background: rgba(0, 0, 0, 0.8);
    border-radius: 20px;
    padding: 30px;
    margin-top: 30px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    animation: secretReveal 1s ease;
}

@keyframes secretReveal {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.secret-label {
    font-size: 20px;
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 15px;
    opacity: 0.9;
}

.secret-content {
    font-size: 32px;
    font-weight: 700;
    padding: 20px;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.05);
    font-family: 'Courier New', monospace;
    letter-spacing: 4px;
}

body.phoenix .secret-content { color: #ff4444; text-shadow: 0 0 10px #ff4444; }
body.dragon .secret-content { color: #44aa44; text-shadow: 0 0 10px #44aa44; }
body.hydra .secret-content { color: #4488ff; text-shadow: 0 0 10px #4488ff; }
body.griffin .secret-content { color: #ffaa00; text-shadow: 0 0 10px #ffaa00; }

.secret-hint {
    margin-top: 15px;
    font-size: 16px;
    font-style: italic;
    opacity: 0.7;
}

/* Last updated */
.last-updated {
    position: fixed;
    bottom: 20px;
    right: 20px;
    font-size: 14px;
    opacity: 0.7;
    background: rgba(0, 0, 0, 0.5);
    padding: 10px 20px;
    border-radius: 20px;
}

/* Loading state */
.loading {
    font-size: 24px;
    text-align: center;
    margin-top: 50px;
}

.hidden {
    display: none;
}
</style>
</head>

<body>
<div class="particles" id="particles"></div>

<div class="loading" id="loading">Loading house data...</div>

<div class="display-container hidden" id="content">
    <!-- House Crest -->
    <div class="house-crest-container">
        <div class="crest-glow"></div>
        <img id="houseCrest" class="house-crest" src="" alt="House Crest">
    </div>

    <!-- House Name -->
    <h1 class="house-name" id="houseName">HOUSE</h1>

    <!-- Stats Card -->
    <div class="stats-card">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">Current Rank</div>
                <div class="stat-value" id="rank">-</div>
                <div class="rank-badge" id="rankBadge">-</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">House Score</div>
                <div class="stat-value" id="points">-</div>
            </div>
        </div>
    </div>

    <!-- Secret Message -->
    <div class="secret-message" id="secretMessage">
        <div class="secret-label">üîê Secret House Code</div>
        <div class="secret-content" id="secretCode">LOADING...</div>
        <div class="secret-hint" id="secretHint">Use this code to unlock today's challenge!</div>
    </div>
</div>

<div class="last-updated" id="lastUpdated">Loading...</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec";

const houses = {
    phoenix: { 
        name: "Phoenix", 
        shield: "phoenix2-removebg.png",
        color: "#ff4444",
        particles: "rgba(255, 68, 68, 0.85)"
    },
    dragon: { 
        name: "Dragon", 
        shield: "dragon2-removebg.png",
        color: "#44aa44",
        particles: "rgba(68, 170, 68, 0.85)"
    },
    hydra: { 
        name: "Hydra", 
        shield: "hydra2-removebg.png",
        color: "#4488ff",
        particles: "rgba(68, 136, 255, 0.85)"
    },
    griffin: { 
        name: "Griffin", 
        shield: "griffin2-removebg.png",
        color: "#ffaa00",
        particles: "rgba(255, 170, 0, 0.85)"
    }
};

// Get house from URL parameter (?house=dragon)
const urlParams = new URLSearchParams(window.location.search);
const houseKey = urlParams.get('house')?.toLowerCase();

if (!houseKey || !houses[houseKey]) {
    document.getElementById('loading').textContent = "Invalid house. Use ?house=phoenix, ?house=dragon, ?house=hydra, or ?house=griffin";
} else {
    initDisplay(houseKey);
}

function initDisplay(houseKey) {
    const house = houses[houseKey];
    
    // Set theme
    document.body.classList.add(houseKey);
    document.getElementById('houseCrest').src = house.shield;
    document.getElementById('houseName').textContent = house.name.toUpperCase();
    
    // Create particles
    createParticles();
    
    // Load data
    loadHouseData(houseKey);
    
    // Auto-refresh every 30 seconds
    setInterval(() => loadHouseData(houseKey), 30000);
}

function createParticles() {
    const container = document.getElementById('particles');
    for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + '%';
        p.style.animationDelay = Math.random() * 5 + 's';
        p.style.animationDuration = (7 + Math.random() * 6) + 's';
        container.appendChild(p);
    }
}

async function loadHouseData(houseKey) {
    try {
        const res = await fetch(`${API_URL}?action=houseTotals`);
        const json = await res.json();
        
        if (json.status !== 'success') throw new Error();
        
        const houseData = json.data.houses.find(h => 
            h.house.toLowerCase() === houses[houseKey].name.toLowerCase()
        );
        
        if (!houseData) throw new Error();
        
        // Update display
        document.getElementById('rank').textContent = houseData.rank;
        document.getElementById('points').textContent = Math.round(houseData.houseScore);
        
        const rankBadge = document.getElementById('rankBadge');
        const ordinals = ['1st', '2nd', '3rd', '4th'];
        rankBadge.textContent = ordinals[houseData.rank - 1];
        rankBadge.className = `rank-badge rank-${houseData.rank}`;
        
        // Generate secret code
        generateSecretCode(houseKey, houseData.rank);
        
        // Show content
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('content').classList.remove('hidden');
        
        // Update timestamp
        document.getElementById('lastUpdated').textContent = 
            'Updated: ' + new Date().toLocaleTimeString();
        
    } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('loading').textContent = 'Error loading data. Retrying...';
    }
}

function generateSecretCode(houseKey, rank) {
    // Generate daily code based on date and house
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0];
    const seed = dateStr + houseKey;
    
    // Simple hash to generate consistent daily code
    let hash = 0;
    for (let i = 0; i < seed.length; i++) {
        hash = ((hash << 5) - hash) + seed.charCodeAt(i);
        hash = hash & hash;
    }
    
    const codeNum = Math.abs(hash) % 10000;
    const code = houses[houseKey].name.substring(0, 3).toUpperCase() + codeNum.toString().padStart(4, '0');
    
    document.getElementById('secretCode').textContent = code;
    
    // Dynamic hints based on rank
    const hints = {
        1: "üèÜ First place! Use this code for bonus points!",
        2: "ü•à Second place! Keep pushing for the top!",
        3: "ü•â Third place! You're gaining ground!",
        4: "üí™ Fourth place! Time to rise up!"
    };
    
    document.getElementById('secretHint').textContent = hints[rank] || "Use this code to unlock today's challenge!";
}

// Add dramatic entrance animation
window.addEventListener('load', () => {
    setTimeout(() => {
        document.getElementById('content')?.classList.add('animate-in');
    }, 100);
});
</script>

</body>
</html>
