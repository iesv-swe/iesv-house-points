<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Points Leaderboard - IESV</title>
<link rel="icon" type="image/x-icon" href="leaderboard-favicon.ico">
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
        background:radial-gradient(circle at top, #1c3f8a 0%, #0a1a3d 40%, #021022 100%);
        height:100vh; display:flex; flex-direction:column;
        padding:20px; color:white; overflow:hidden;
    }
    .header {
        display:flex; align-items:center; gap:20px; margin-bottom:20px;
        animation:fadeIn 1s ease; max-width:1400px; margin-inline:auto;
    }
    .logo { width:72px; filter:brightness(0) invert(1); }
    h1 { font-size:36px; font-weight:700; margin-bottom:5px;
        text-shadow:2px 2px 10px rgba(0,0,0,0.6); }
    .subtitle { font-size:16px; opacity:0.9; }

    .leaderboard {
        flex:1; display:grid; grid-template-columns:repeat(2,1fr);
        grid-gap:20px; max-width:1400px; width:100%; margin-inline:auto;
    }

    .house-card {
        position:relative;
        background:linear-gradient(135deg, rgba(255,255,255,0.98), rgba(240,240,255,0.95));
        border-radius:18px; padding:26px;
        box-shadow:0 14px 45px rgba(0,0,0,0.45);
        display:flex; flex-direction:column; justify-content:space-between;
        transition:.4s ease; animation:slideIn .8s ease;
        overflow:hidden;
    }
    .house-card::before {
        content:"";
        position:absolute; inset:-40%;
        background:radial-gradient(circle, rgba(255,255,255,0.25) 0%, transparent 60%);
        opacity:0; pointer-events:none;
        animation:cardGlow 5s infinite ease-in-out;
    }
    .house-card.rank-1::before { opacity:1; }
    .house-card.rank-1 { border:4px solid #ffd700; }
    .house-card:hover { transform:translateY(-3px) scale(1.01);
        box-shadow:0 18px 55px rgba(0,0,0,0.6); }

    .house-header { display:flex; align-items:center; justify-content:space-between; z-index:2; position:relative; }
    .house-info { display:flex; align-items:center; gap:15px; }
    .house-icon { font-size:60px; animation:bounceIcon 2.2s infinite; }
    .house-name { font-size:42px; font-weight:800; letter-spacing:1px; }

    .rank-badge {
        background:#102d69; color:white; width:58px; height:58px;
        border-radius:50%; display:flex; align-items:center;
        justify-content:center; font-size:20px; font-weight:800;
        box-shadow:0 5px 18px rgba(0,0,0,0.35);
    }
    .rank-badge.gold {
        background:conic-gradient(from 30deg,#fff6b0,#ffd700,#ffed4e,#fff6b0);
        color:#102d69; animation:pulse 2.4s infinite;
    }

    /* POINTS + EFFECTS */
    .points-wrapper {
        position:relative; text-align:center; margin-top:24px;
        padding:22px 0 16px;
    }
    .points-background-ring {
        position:absolute; inset:0;
        background:radial-gradient(circle, rgba(255,215,0,0.25) 0%, transparent 70%);
        opacity:0.3;
    }
    .points {
        position:relative;
        font-size:94px; font-weight:900; color:#102d69;
        text-shadow:0 4px 20px rgba(0,0,0,0.35);
        display:inline-block; z-index:2;
    }
    .points.pop {
        animation:slowPop 1.2s ease-out;
    }

    /* CONSTANT TWINKLES */
    .twinkle {
        position:absolute; width:9px; height:9px; background:#fff8d1;
        border-radius:50%; opacity:0.0; filter:blur(1px);
        animation:twinkle 2.8s infinite ease-in-out;
    }
    .twinkle::after {
        content:"";
        position:absolute; inset:-60%;
        border-radius:50%;
        border:2px solid rgba(255,255,255,0.55);
        opacity:0.0;
        animation:twinkleRing 2.8s infinite ease-in-out;
    }

    /* FIREWORK BURSTS (around number) */
    .burst-sparkle {
        position:absolute; width:12px; height:12px;
        border-radius:50%;
        background:radial-gradient(circle, #fff8d1 0%, #ffd700 40%, rgba(255,215,0,0) 70%);
        box-shadow:0 0 12px rgba(255,215,0,0.9);
        pointer-events:none;
        animation:burst 0.9s ease-out forwards;
    }

    /* FOUNTAIN SPARKS (downward) */
    .fountain-sparkle {
        position:absolute; width:8px; height:14px;
        border-radius:999px;
        background:linear-gradient(to bottom,#fff8d1,#ffd700,#ff9f1c);
        box-shadow:0 0 12px rgba(255,215,0,0.9);
        pointer-events:none;
        animation:fountain 1.1s ease-out forwards;
    }

    .phoenix .house-name { color:#ff4444; }
    .dragon .house-name { color:#44aa44; }
    .hydra .house-name { color:#4488ff; }
    .griffin .house-name { color:#ffaa00; }

    .last-updated {
        text-align:center; font-size:13px; opacity:0.85; margin-top:10px;
        text-shadow:0 2px 6px rgba(0,0,0,0.4);
    }

    /* KEYFRAMES */
    @keyframes slideIn { from{opacity:0; transform:translateX(-50px);} to{opacity:1; transform:translateX(0);} }
    @keyframes bounceIcon { 0%,100%{transform:translateY(0);}50%{transform:translateY(-9px);} }
    @keyframes pulse { 0%,100%{transform:scale(1);}50%{transform:scale(1.1);} }
    @keyframes cardGlow {
        0%,100%{opacity:0.35; transform:scale(1);}
        50%{opacity:0.7; transform:scale(1.15);}
    }

    @keyframes slowPop {
        0%   { transform:scale(1); }
        20%  { transform:scale(1.4); }
        50%  { transform:scale(1.6) rotate(2deg); }
        80%  { transform:scale(1.3); }
        100% { transform:scale(1); }
    }
    @keyframes twinkle {
        0%,100%{opacity:0; transform:scale(0.3);}
        40%{opacity:1; transform:scale(1.1);}
    }
    @keyframes twinkleRing {
        0%{opacity:0; transform:scale(0.3);}
        40%{opacity:0.8; transform:scale(1.1);}
        100%{opacity:0; transform:scale(1.5);}
    }
    @keyframes burst {
        0%{transform:translate(0,0) scale(0.6); opacity:1;}
        70%{opacity:1;}
        100%{transform:translate(var(--dx), var(--dy)) scale(0.1); opacity:0;}
    }
    @keyframes fountain {
        0%{transform:translate(0,0) scale(0.8); opacity:1;}
        100%{transform:translate(var(--fx), 55px) scale(0.2); opacity:0;}
    }

    @media(max-width:1024px){
        .leaderboard { grid-template-columns:1fr; }
        body { height:auto; overflow:auto; }
        .points { font-size:68px; }
    }
</style>
</head>
<body>

<div class="header">
    <img src="https://raw.githubusercontent.com/iesv-swe/IESV-Now-and-Next/main/logo.png" class="logo">
    <div>
        <h1>House Points Leaderboard</h1>
        <p class="subtitle">Live Rankings</p>
    </div>
</div>

<div class="leaderboard" id="leaderboard"></div>
<div class="last-updated" id="lastUpdated">Loading data...</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec?action=houseTotals";

const houseIcons = { Phoenix:'ðŸ”¥', Dragon:'ðŸ‰', Hydra:'ðŸŒŠ', Griffin:'ðŸ¦…' };
const houseColors = { Phoenix:'phoenix', Dragon:'dragon', Hydra:'hydra', Griffin:'griffin' };

async function loadLeaderboard() {
    try {
        const r = await fetch(API);
        const j = await r.json();
        if (j.status !== "success") throw "Bad response";
        const houses = j.data.houses.sort((a,b)=>a.rank-b.rank);
        displayLeaderboard(houses);
        document.getElementById('lastUpdated').textContent =
            `Last updated: ${new Date().toLocaleString()}`;
    } catch {
        document.getElementById('lastUpdated').textContent =
            "Error loading leaderboard.";
    }
}

function displayLeaderboard(houses) {
    const div = document.getElementById("leaderboard");
    div.innerHTML = "";

    houses.forEach(h => {
        const ord = h.rank===1?'1st':h.rank===2?'2nd':h.rank===3?'3rd':'4th';
        const rankClass = h.rank===1?'gold':'';
        const cardClass = h.rank===1?'rank-1':'';

        div.innerHTML += `
        <div class="house-card ${houseColors[h.house]} ${cardClass}">
            <div class="house-header">
                <div class="house-info">
                    <div class="house-icon">${houseIcons[h.house]}</div>
                    <div class="house-name">${h.house}</div>
                </div>
                <div class="rank-badge ${rankClass}">${ord}</div>
            </div>
            <div class="points-wrapper">
                <div class="points-background-ring"></div>
                <div class="points" id="pts-${h.house}">${h.totalPoints}</div>
            </div>
        </div>`;
    });

    setupTwinkles();
    animatePointsAndFireworks();
}

function setupTwinkles() {
    document.querySelectorAll(".points-wrapper").forEach(wrapper => {
        wrapper.querySelectorAll(".twinkle").forEach(t=>t.remove());
        for (let i = 0; i < 7; i++) {
            const t = document.createElement("div");
            t.className = "twinkle";
            t.style.left = `${25 + Math.random()*50}%`;
            t.style.top = `${10 + Math.random()*60}%`;
            t.style.animationDelay = `${Math.random()*2.5}s`;
            wrapper.appendChild(t);
        }
    });
}

function animatePointsAndFireworks() {
    document.querySelectorAll(".points").forEach(p => {
        p.classList.remove("pop");
        void p.offsetWidth;
        p.classList.add("pop");

        const wrapper = p.parentElement;
        // Burst sparks around number
        for (let i=0;i<10;i++){
            const b = document.createElement("div");
            b.className = "burst-sparkle";
            const angle = Math.random()*2*Math.PI;
            const dist = 55 + Math.random()*25;
            b.style.setProperty("--dx", `${Math.cos(angle)*dist}px`);
            b.style.setProperty("--dy", `${Math.sin(angle)*dist}px`);
            b.style.left = "50%";
            b.style.top = "45%";
            b.style.transform = "translate(-50%,-50%)";
            wrapper.appendChild(b);
            setTimeout(()=>b.remove(), 900);
        }
        // Fountain sparks beneath number
        for (let i=0;i<10;i++){
            const f = document.createElement("div");
            f.className = "fountain-sparkle";
            const spread = (Math.random()*60 - 30);
            f.style.setProperty("--fx", `${spread}px`);
            f.style.left = "50%";
            f.style.top = "60%";
            f.style.transform = "translate(-50%,0)";
            wrapper.appendChild(f);
            setTimeout(()=>f.remove(), 1100);
        }
    });
}

loadLeaderboard();
setInterval(loadLeaderboard, 30000);
</script>

</body>
</html>
