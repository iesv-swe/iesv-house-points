<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Points Leaderboard - IESV</title>
<link rel="icon" type="image/x-icon" href="leaderboard-favicon.ico">

<style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background:url("stone.png") center/cover no-repeat fixed;
        min-height:100vh;
        display:flex;
        flex-direction:column;
        padding:20px;
        color:white;
        overflow:auto;
        position:relative;
        animation:page-fade-in 0.6s ease;
    }

    @keyframes page-fade-in {
        from { opacity:0; }
        to { opacity:1; }
    }

    /* ðŸ”¥ Ember Particles */
    .particles {
        position:fixed;
        top:0; left:0;
        width:100%; height:100%;
        pointer-events:none;
        z-index:0;
        overflow:hidden;
    }

    .particle {
        position:absolute;
        background:rgba(255,120,0,0.7);
        border-radius:50%;
        filter:blur(1px);
        animation:ember-float 12s infinite linear;
    }

    @keyframes ember-float {
        0% {
            transform:translateY(0) translateX(0);
            opacity:0;
        }
        10% { opacity:1; }
        90% { opacity:0.9; }
        100% {
            transform:translateY(-120vh) translateX(-20px);
            opacity:0;
        }
    }

    .header {
        display:flex;
        align-items:center;
        gap:20px;
        margin-bottom:20px;
        max-width:1400px;
        margin-inline:auto;
        position:relative;
        z-index:1;
        text-shadow:0 0 10px black;
    }

    .logo {
        width:72px;
        filter:drop-shadow(0 0 6px black) brightness(0.9);
        flex-shrink:0;
    }

    h1 {
        font-size:38px;
        font-weight:700;
        margin-bottom:5px;
    }

    .subtitle {
        font-size:16px;
        opacity:0.9;
    }

    /* ðŸª¨ Stone-Glass Cards */
    .leaderboard {
        flex:1;
        display:grid;
        grid-template-columns:repeat(2, minmax(0,1fr));
        gap:18px;
        max-width:1400px;
        margin:0 auto;
        width:100%;
        position:relative;
        z-index:1;
    }

    .house-card {
        position:relative;
        background:rgba(32,32,32,0.78);
        backdrop-filter:blur(4px);
        border-radius:20px;
        padding:18px 22px 20px;
        box-shadow:0 10px 35px rgba(0,0,0,0.5);
        display:flex;
        flex-direction:column;
        transition:transform .25s ease, box-shadow .25s ease;
        min-height:230px;
        overflow:hidden;
        cursor:pointer;
    }

    .house-card:hover {
        transform:translateY(-3px);
        box-shadow:0 16px 55px rgba(0,0,0,0.65);
    }

    /* Winner Highlight â€“ softer, warmer */
    .house-card.winner {
        border:2px solid rgba(255,180,0,0.95);
        box-shadow:0 0 26px rgba(255,150,0,0.7);
    }

    /* Ember Confetti for winner */
    .confetti {
        position:absolute;
        width:6px;
        height:6px;
        background:rgba(255,140,0,0.95);
        border-radius:50%;
        animation:ember-confetti 3.2s linear infinite;
        filter:blur(0.4px);
    }

    @keyframes ember-confetti {
        0% { transform:translateY(-20px); opacity:0; }
        10% { opacity:1; }
        100% {
            transform:translateY(220px);
            opacity:0;
        }
    }

    .house-header {
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin-bottom:10px;
        z-index:1;
        text-shadow:0 0 8px black;
    }

    .house-info {
        display:flex;
        align-items:center;
        gap:16px;
    }

    /* ðŸ›¡ Dark Carved-Stone Medallion */
    .house-medallion {
        width:96px;
        height:96px;
        border-radius:50%;
        background:radial-gradient(circle at 30% 25%, #555 0, #333 35%, #121212 80%, #000 100%);
        position:relative;
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow:
            0 0 0 2px rgba(0,0,0,0.8),
            0 0 14px rgba(0,0,0,0.9);
        overflow:hidden;
    }

    /* subtle notched rim */
    .house-medallion::before {
        content:"";
        position:absolute;
        inset:5px;
        border-radius:50%;
        border:2px solid rgba(0,0,0,0.85);
        box-shadow:inset 0 0 10px rgba(0,0,0,0.8);
        mask-image:radial-gradient(circle at 50% 50%, transparent 62%, black 64%);
        opacity:0.9;
    }

    .house-medallion::after {
        content:"";
        position:absolute;
        inset:4px;
        border-radius:50%;
        border:2px dashed rgba(0,0,0,0.8); /* geometric notches */
        opacity:0.55;
    }

    .house-icon {
        width:70%;
        height:auto;
        position:relative;
        z-index:1;
        filter:drop-shadow(0 0 6px rgba(0,0,0,0.8));
        pointer-events:none;
    }

    .house-card:hover .house-medallion {
        box-shadow:
            0 0 0 2px rgba(255,180,0,0.6),
            0 0 20px rgba(255,150,0,0.7);
    }

    .house-name {
        font-size:30px;
        font-weight:700;
        text-shadow:0 0 6px black;
    }

    /* Metallic Rank Badges */
    .rank-badge {
        width:56px;
        height:56px;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        font-size:18px;
        font-weight:700;
        box-shadow:0 6px 16px rgba(0,0,0,0.6);
        border:2px solid rgba(0,0,0,0.8);
        background:linear-gradient(145deg,#3b3b3b,#121212);
        color:#f5f5f5;
    }

    .gold {
        background:linear-gradient(145deg,#ffcf40,#ffb300);
        color:#3b2600;
    }

    .silver {
        background:linear-gradient(145deg,#d0d0d0,#f0f0f0);
        color:#303030;
    }

    .bronze {
        background:linear-gradient(145deg,#b06b2c,#e49a5e);
        color:#291407;
    }

    /* Points section */
    .points-area {
        flex:1;
        display:flex;
        flex-direction:column;
        justify-content:center;
        align-items:center;
        z-index:1;
    }

    .points-label {
        font-size:13px;
        text-transform:uppercase;
        letter-spacing:1px;
        color:#d0d0d0;
        margin-bottom:6px;
    }

    .points {
        font-size:70px;
        font-weight:900;
        color:#ffffff;
        text-shadow:0 0 12px #000;
    }

    /* ðŸ”¥ Winner Points Glow â€“ refined */
    .points.winner-points {
        text-shadow:
            0 0 8px rgba(255,150,0,0.9),
            0 0 18px rgba(255,140,0,1),
            0 0 32px rgba(255,100,0,1),
            0 0 58px rgba(255,70,0,1);
        animation:firePulse 2.6s ease-in-out infinite;
    }

    @keyframes firePulse {
        0%,100% {
            text-shadow:
                0 0 6px rgba(255,140,0,0.8),
                0 0 16px rgba(255,120,0,1),
                0 0 26px rgba(255,90,0,1),
                0 0 46px rgba(255,60,0,1);
        }
        50% {
            text-shadow:
                0 0 10px rgba(255,210,0,1),
                0 0 26px rgba(255,170,0,1),
                0 0 44px rgba(255,110,0,1),
                0 0 78px rgba(255,70,0,1);
        }
    }

    /* House title colours */
    .phoenix .house-name { color:#ff4d4d; }
    .dragon  .house-name { color:#41d441; }
    .hydra   .house-name { color:#64a9ff; }
    .griffin .house-name { color:#ffbc3c; }

    .last-updated {
        text-align:center;
        margin-top:15px;
        font-size:12px;
        opacity:0.9;
        text-shadow:0 0 8px black;
    }

    @media (max-width:1024px) {
        .leaderboard { grid-template-columns:1fr; }
        body { padding:12px; }
        .points { font-size:58px; }
        .house-card { min-height:220px; }
    }
</style>
</head>
<body>

<div class="particles" id="particles"></div>

<div class="header">
    <img src="https://raw.githubusercontent.com/iesv-swe/IESV-Now-and-Next/main/logo.png" alt="IESV Logo" class="logo">
    <div class="header-text">
        <h1>House Points Leaderboard</h1>
        <p class="subtitle">Live Rankings</p>
    </div>
</div>

<div class="leaderboard" id="leaderboard"></div>

<div class="last-updated" id="lastUpdated">Loading data...</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec?action=houseTotals";

/* Shield icon paths */
const houseIcons = {
    Phoenix: "phoenix2-removebg.png",
    Dragon:  "dragon2-removebg.png",
    Hydra:   "hydra2-removebg.png",
    Griffin: "griffin2-removebg.png"
};

const houseColors = {
    Phoenix: "phoenix",
    Dragon:  "dragon",
    Hydra:   "hydra",
    Griffin: "griffin"
};

async function loadLeaderboard() {
    try {
        const res = await fetch(API);
        const json = await res.json();
        if (json.status !== "success") throw new Error("Bad API response");

        const houses = json.data.houses.sort((a,b) => a.rank - b.rank);
        renderLeaderboard(houses);

        document.getElementById("lastUpdated").textContent =
            "Last updated: " + new Date().toLocaleString();
    } catch (err) {
        console.error(err);
        document.getElementById("lastUpdated").textContent =
            "Error loading data. Please refresh.";
    }
}

function renderLeaderboard(houses) {
    const board = document.getElementById("leaderboard");
    board.innerHTML = "";

    houses.forEach(house => {
        const rankOrdinal =
            house.rank === 1 ? "1st" :
            house.rank === 2 ? "2nd" :
            house.rank === 3 ? "3rd" : "4th";

        const rankClass =
            house.rank === 1 ? "gold" :
            house.rank === 2 ? "silver" :
            house.rank === 3 ? "bronze" : "";

        const winnerCardClass   = house.rank === 1 ? "winner" : "";
        const winnerPointsClass = house.rank === 1 ? "winner-points" : "";

        const card = document.createElement('div');
        card.className = `house-card ${houseColors[house.house] || ""} ${winnerCardClass}`;
        card.onclick = () =>
            window.location.href = `house-page.html?house=${house.house.toLowerCase()}`;

        card.innerHTML = `
            <div class="house-header">
                <div class="house-info">
                    <div class="house-medallion">
                        <img src="${houseIcons[house.house]}" class="house-icon" alt="${house.house}">
                    </div>
                    <div class="house-name">${house.house}</div>
                </div>
                <div class="rank-badge ${rankClass}">${rankOrdinal}</div>
            </div>

            <div class="points-area">
                <div class="points-label">House Score</div>
                <div class="points ${winnerPointsClass}">
                    ${parseFloat(house.houseScore).toFixed(2)}
                </div>
            </div>
        `;

        if (house.rank === 1) {
            for (let i = 0; i < 32; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = (10 + Math.random() * 80) + '%';
                c.style.top = '-40px';
                c.style.animationDelay = (Math.random() * 2.5) + 's';
                card.appendChild(c);
            }
        }

        board.appendChild(card);
    });
}

function createParticles() {
    const particlesContainer = document.getElementById('particles');
    for (let i = 0; i < 22; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + '%';
        p.style.width = (Math.random() * 4 + 2) + 'px';
        p.style.height = p.style.width;
        p.style.animationDelay = Math.random() * 12 + 's';
        particlesContainer.appendChild(p);
    }
}

createParticles();
loadLeaderboard();
setInterval(loadLeaderboard, 30000);
</script>

</body>
</html>
