<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Points Leaderboard - IESV</title>
<link rel="icon" type="image/x-icon" href="leaderboard-favicon.ico">
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #102d69 0%, #00a0df 100%);
        min-height:100vh;
        display:flex;
        flex-direction:column;
        padding:20px;
        color:white;
        overflow:auto;
    }

    .header {
        display:flex;
        align-items:center;
        gap:20px;
        margin-bottom:20px;
        animation:fadeIn 1s ease;
        max-width:1400px;
        margin-inline:auto;
    }

    .logo {
        width:72px;
        filter:brightness(0) invert(1);
        flex-shrink:0;
    }

    .header-text { flex:1; }

    h1 {
        font-size:36px;
        font-weight:700;
        margin-bottom:5px;
        text-shadow:2px 2px 10px rgba(0, 0, 0, 0.3);
    }

    .subtitle {
        font-size:16px;
        opacity:0.9;
    }

    .leaderboard {
        flex:1;
        display:grid;
        grid-template-columns:repeat(2, 1fr);
        grid-template-rows:repeat(2, 1fr);
        gap:15px;
        max-width:1400px;
        margin:0 auto;
        width:100%;
    }

    .house-card {
        background:rgba(255, 255, 255, 0.96);
        border-radius:18px;
        padding:20px;
        box-shadow:0 10px 40px rgba(0,0,0,0.35);
        transition:all 0.4s ease;
        animation:slideIn 0.8s ease;
        display:flex;
        flex-direction:column;
        justify-content:space-between;
        min-height:210px;
        position:relative;
        overflow:hidden;
    }

    .house-card:hover {
        transform:translateY(-3px);
        box-shadow:0 16px 50px rgba(0,0,0,0.45);
    }

    .house-card.rank-1 {
        border:4px solid gold;
    }

    /* winner glow */
    .house-card.rank-1::before {
        content:"";
        position:absolute;
        inset:-40%;
        background:radial-gradient(circle, rgba(255,255,255,0.35) 0%, transparent 60%);
        opacity:0.7;
        pointer-events:none;
        animation:winnerGlow 3s infinite ease-in-out;
    }

    .house-header {
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin-bottom:15px;
        position:relative;
        z-index:1;
    }

    .house-info {
        display:flex;
        align-items:center;
        gap:15px;
    }

    .house-icon {
        font-size:50px;
        animation:bounce 2s infinite;
    }

    .house-name {
        font-size:32px;
        font-weight:700;
    }

    .rank-badge {
        background:#102d69;
        color:white;
        width:50px;
        height:50px;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        font-size:18px;
        font-weight:700;
        box-shadow:0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .rank-badge.gold {
        background:linear-gradient(135deg, #ffd700, #ffed4e);
        color:#102d69;
        animation:pulse 2s infinite;
    }

    .rank-badge.silver {
        background:linear-gradient(135deg, #c0c0c0, #e8e8e8);
    }

    .rank-badge.bronze {
        background:linear-gradient(135deg, #cd7f32, #e8a87c);
    }

    .stats-row {
        display:grid;
        grid-template-columns:1fr;
        gap:10px;
        margin-bottom:18px;
    }

    .stat-box {
        text-align:center;
        padding:12px;
        background:rgba(16, 45, 105, 0.04);
        border-radius:10px;
    }

    .stat-label {
        font-size:13px;
        color:#9a9b9d;
        margin-bottom:3px;
        text-transform:uppercase;
        letter-spacing:0.8px;
    }

    .stat-value {
        font-size:42px;
        font-weight:800;
        color:#102d69;
    }

    .score-bar-container {
        background:rgba(16, 45, 105, 0.1);
        height:32px;
        border-radius:18px;
        overflow:hidden;
        position:relative;
    }

    .score-bar {
        height:100%;
        border-radius:18px;
        transition:width 1s ease;
        display:flex;
        align-items:center;
        justify-content:flex-end;
        padding-right:12px;
        color:white;
        font-weight:700;
        font-size:16px;
        background-size:200% 100%;
    }

    /* shimmer on winner bar */
    .house-card.rank-1 .score-bar {
        animation:barShimmer 2.5s infinite linear;
    }

    .phoenix .house-name { color:#ff4444; }
    .phoenix .score-bar {
        background:linear-gradient(90deg, #ff4444, #ff8844, #ff4444);
    }

    .dragon .house-name { color:#44aa44; }
    .dragon .score-bar {
        background:linear-gradient(90deg, #44aa44, #88dd44, #44aa44);
    }

    .hydra .house-name { color:#4488ff; }
    .hydra .score-bar {
        background:linear-gradient(90deg, #4488ff, #44ddff, #4488ff);
    }

    .griffin .house-name { color:#ffaa00; }
    .griffin .score-bar {
        background:linear-gradient(90deg, #ffaa00, #ffdd44, #ffaa00);
    }

    .last-updated {
        text-align:center;
        margin-top:15px;
        font-size:12px;
        opacity:0.85;
    }

    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

    @keyframes slideIn {
        from { opacity:0; transform:translateX(-40px); }
        to { opacity:1; transform:translateX(0); }
    }

    @keyframes bounce {
        0%, 100% { transform:translateY(0); }
        50% { transform:translateY(-8px); }
    }

    @keyframes pulse {
        0%, 100% { transform:scale(1); }
        50% { transform:scale(1.08); }
    }

    @keyframes winnerGlow {
        0%,100% { opacity:0.4; transform:scale(1); }
        50% { opacity:0.9; transform:scale(1.1); }
    }

    @keyframes barShimmer {
        0% { background-position:0 0; }
        100% { background-position:200% 0; }
    }

    @media (max-width:1024px) {
        .leaderboard {
            grid-template-columns:1fr;
            grid-template-rows:auto;
        }
        body {
            height:auto;
            overflow:auto;
        }
    }
</style>
</head>
<body>
    <div class="header">
        <img src="https://raw.githubusercontent.com/iesv-swe/IESV-Now-and-Next/main/logo.png" alt="IES Logo" class="logo">
        <div class="header-text">
            <h1>House Points Leaderboard</h1>
            <p class="subtitle">Live Rankings</p>
        </div>
    </div>

    <div class="leaderboard" id="leaderboard"></div>

    <div class="last-updated" id="lastUpdated">
        Loading data...
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec?action=houseTotals";

        const houseIcons = {
            Phoenix: 'ðŸ”¥',
            Dragon: 'ðŸ‰',
            Hydra: 'ðŸŒŠ',
            Griffin: 'ðŸ¦…'
        };

        const houseColors = {
            Phoenix: 'phoenix',
            Dragon: 'dragon',
            Hydra: 'hydra',
            Griffin: 'griffin'
        };

        async function loadLeaderboard() {
            try {
                const res = await fetch(API);
                const json = await res.json();

                if (json.status !== "success") throw new Error("Bad API response");

                const houses = json.data.houses.sort((a, b) => a.rank - b.rank);

                displayLeaderboard(houses);

                document.getElementById('lastUpdated').textContent =
                    `Last updated: ${new Date().toLocaleString()}`;

            } catch (error) {
                console.error('Error loading leaderboard:', error);
                document.getElementById('lastUpdated').textContent =
                    'Error loading data. Please refresh the page.';
            }
        }

        function displayLeaderboard(houses) {
            const leaderboardDiv = document.getElementById('leaderboard');
            leaderboardDiv.innerHTML = '';

            const maxScore = Math.max(...houses.map(h => h.houseScore), 1);

            houses.forEach(house => {
                const rankClass = house.rank === 1 ? 'gold' :
                                  house.rank === 2 ? 'silver' :
                                  house.rank === 3 ? 'bronze' : '';

                const cardClass = house.rank === 1 ? 'rank-1' : '';
                const barWidth = maxScore > 0 ? (house.houseScore / maxScore * 100) : 0;

                const rankOrdinal = house.rank === 1 ? '1st' :
                                    house.rank === 2 ? '2nd' :
                                    house.rank === 3 ? '3rd' : '4th';

                const houseCard = `
                    <div class="house-card ${houseColors[house.house]} ${cardClass}">
                        <div class="house-header">
                            <div class="house-info">
                                <div class="house-icon">${houseIcons[house.house]}</div>
                                <div class="house-name">${house.house}</div>
                            </div>
                            <div class="rank-badge ${rankClass}">${rankOrdinal}</div>
                        </div>

                        <div class="stats-row">
                            <div class="stat-box">
                                <div class="stat-label">Total Points</div>
                                <div class="stat-value">${house.totalPoints}</div>
                            </div>
                        </div>

                        <div class="score-bar-container">
                            <div class="score-bar" style="width: ${barWidth}%">
                                ${house.houseScore.toFixed(2)}
                            </div>
                        </div>
                    </div>
                `;

                leaderboardDiv.innerHTML += houseCard;
            });
        }

        loadLeaderboard();
        setInterval(loadLeaderboard, 30000);
    </script>
</body>
</html>
