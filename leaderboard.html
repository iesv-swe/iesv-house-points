<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Points Leaderboard - IESV</title>
<link rel="icon" type="image/x-icon" href="leaderboard-favicon.ico">

<style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background:url('stone.png') repeat;
        background-size:600px;
        min-height:100vh;
        padding:20px;
        color:white;
        overflow:hidden;
        position:relative;
    }

    /* Floating particles */
    .particles {
        position:fixed;
        inset:0;
        pointer-events:none;
        z-index:0;
    }

    .particle {
        position:absolute;
        width:4px; height:4px;
        background:rgba(255,140,0,0.85);
        border-radius:50%;
        animation:float 8s infinite ease-in-out;
    }

    @keyframes float {
        0% { transform:translateY(0); opacity:0; }
        10% { opacity:1; }
        100% { transform:translateY(-120vh); opacity:0; }
    }

    /* Header */
    .header {
        display:flex;
        align-items:center;
        gap:20px;
        margin-bottom:20px;
        position:relative;
        z-index:5;
        text-shadow:0 4px 12px black;
    }

    .logo {
        width:78px;
        filter:brightness(0) invert(1);
    }

    h1 {
        font-size:38px;
        font-weight:800;
    }

    .subtitle {
        font-size:16px;
        opacity:0.9;
        margin-top:-4px;
    }

    /* NEW LAYOUT: 1Ã—3 */
    .leaderboard {
        display:flex;
        flex-direction:column;
        gap:20px;
        width:100%;
        height:calc(100vh - 160px);
        overflow:hidden;
        z-index:5;
    }

    /* Top Winner Card */
    .winner-wrap {
        display:flex;
        justify-content:center;
        width:100%;
    }

    .winner-card {
        width:90%;
        max-width:1400px;
        min-height:280px;
        background:rgba(0,0,0,0.55);
        border-radius:22px;
        padding:22px;
        box-shadow:0 8px 30px rgba(0,0,0,0.75);
        position:relative;
        border:3px solid rgba(255,170,40,1);
        animation:winnerGlow 3.5s infinite ease-in-out;
        backdrop-filter:blur(6px);
        overflow:hidden;
        cursor:pointer;
    }

    @keyframes winnerGlow {
        0% {
            box-shadow:0 0 22px rgba(255,150,0,1),
                       0 0 44px rgba(255,120,0,0.8),
                       inset 0 0 18px rgba(255,120,0,0.6);
        }
        50% {
            box-shadow:0 0 42px rgba(255,180,0,1),
                       0 0 72px rgba(255,150,0,0.9),
                       inset 0 0 32px rgba(255,140,0,0.7);
        }
        100% {
            box-shadow:0 0 22px rgba(255,150,0,1),
                       0 0 44px rgba(255,120,0,0.8),
                       inset 0 0 18px rgba(255,120,0,0.6);
        }
    }

    /* Bottom row (three cards) */
    .row-3 {
        display:flex;
        justify-content:space-between;
        gap:16px;
        width:100%;
        height:100%;
    }

    .small-card {
        flex:1;
        background:rgba(0,0,0,0.55);
        border-radius:20px;
        padding:18px;
        box-shadow:0 6px 22px rgba(0,0,0,0.65);
        border:2px solid rgba(255,255,255,0.06);
        backdrop-filter:blur(4px);
        cursor:pointer;
        overflow:hidden;
        position:relative;
        min-height:220px;
    }

    .crest-wrap {
        width:90px;
        height:90px;
        border-radius:50%;
        background:url('stone-medallion-B.png') center/cover no-repeat;
        display:flex;
        justify-content:center;
        align-items:center;
        margin-bottom:10px;
    }

    .crest-wrap img {
        width:74%;
        filter:drop-shadow(0 2px 4px black);
    }

    .house-name {
        font-size:26px;
        font-weight:800;
        text-shadow:0 3px 12px black;
        text-align:center;
        margin-bottom:8px;
    }

    .points {
        font-size:clamp(70px, 14vw, 200px);
        font-weight:900;
        color:white;
        text-shadow:0 6px 22px rgba(0,0,0,0.9);
        text-align:center;
        line-height:1;
        margin-top:20px;
    }

    .rank-badge {
        position:absolute;
        top:14px;
        right:14px;
        width:48px; height:48px;
        border-radius:50%;
        font-weight:700;
        display:flex;
        justify-content:center;
        align-items:center;
        color:black;
        border:2px solid rgba(255,255,255,0.25);
        background:rgba(255,255,255,0.3);
    }

    .gold   { background:linear-gradient(135deg,#ffd700,#ffae00); }
    .silver { background:linear-gradient(135deg,#d4d4d4,#fafafa); }
    .bronze { background:linear-gradient(135deg,#cd7f32,#e3a46d); }

    .last-updated {
        text-align:center;
        opacity:0.85;
        margin-top:4px;
        font-size:12px;
    }
</style>
</head>
<body>

<div class="particles" id="particles"></div>

<div class="header">
    <img src="https://raw.githubusercontent.com/iesv-swe/IESV-Now-and-Next/main/logo.png" class="logo">
    <div>
        <h1>House Points Leaderboard</h1>
        <p class="subtitle">Live Rankings</p>
    </div>
</div>

<div class="leaderboard" id="leaderboard"></div>

<div class="last-updated" id="lastUpdated">Loading data...</div>

<script>
const API =
 "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec?action=houseTotals";

const shields = {
    Phoenix:"phoenix2-removebg.png",
    Dragon:"dragon2-removebg.png",
    Hydra:"hydra2-removebg.png",
    Griffin:"griffin2-removebg.png"
};

function roundScore(n){ return Math.round(parseFloat(n)); }

async function loadLeaderboard(){
    const board = document.getElementById("leaderboard");
    board.innerHTML = "";

    const res = await fetch(API);
    const json = await res.json();
    const houses = json.data.houses.sort((a,b)=>a.rank-b.rank);

    /* TOP WINNER CARD */
    const winner = houses[0];

    const winnerDiv = document.createElement("div");
    winnerDiv.className = "winner-wrap";
    winnerDiv.innerHTML = `
        <div class="winner-card" onclick="window.location.href='house-page.html?house=${winner.house.toLowerCase()}'">
            <div class="rank-badge gold">1st</div>
            <div class="crest-wrap"><img src="${shields[winner.house]}"></div>
            <div class="house-name">${winner.house}</div>
            <div class="points">${roundScore(winner.houseScore)}</div>
        </div>
    `;
    board.appendChild(winnerDiv);

    /* BOTTOM 3 CARDS */
    const row = document.createElement("div");
    row.className = "row-3";

    houses.slice(1).forEach(h=>{
        const rankClass =
          h.rank===2 ? "silver" :
          h.rank===3 ? "bronze" : "";

        const card = document.createElement("div");
        card.className = "small-card";
        card.onclick = ()=>window.location.href=`house-page.html?house=${h.house.toLowerCase()}`;

        card.innerHTML = `
            <div class="rank-badge ${rankClass}">
                ${h.rank}${h.rank===2?"nd":h.rank===3?"rd":"th"}
            </div>
            <div class="crest-wrap"><img src="${shields[h.house]}"></div>
            <div class="house-name">${h.house}</div>
            <div class="points">${roundScore(h.houseScore)}</div>
        `;
        row.appendChild(card);
    });

    board.appendChild(row);

    document.getElementById("lastUpdated").textContent =
        "Last updated: " + new Date().toLocaleString();
}

/* Particles */
function createParticles(){
    const container=document.getElementById("particles");
    for(let i=0;i<28;i++){
        const p=document.createElement("div");
        p.className="particle";
        p.style.left=Math.random()*100+"%";
        p.style.animationDelay=Math.random()*5+"s";
        p.style.animationDuration=(7+Math.random()*6)+"s";
        container.appendChild(p);
    }
}

createParticles();
loadLeaderboard();
setInterval(loadLeaderboard,30000);
</script>

</body>
</html>
