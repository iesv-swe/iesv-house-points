<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Points Leaderboard - IESV</title>
<link rel="icon" type="image/x-icon" href="leaderboard-favicon.ico">
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
        background:linear-gradient(135deg,#102d69 0%,#00a0df 100%);
        min-height:100vh;
        display:flex;
        flex-direction:column;
        padding:20px;
        color:white;
        overflow:auto;
    }
    .header {
        display:flex;
        align-items:center;
        gap:20px;
        margin-bottom:20px;
        animation:fadeIn 1s ease;
        max-width:1200px;
        margin-inline:auto;
    }
    .logo { width:64px; filter:brightness(0) invert(1); }
    h1 {
        font-size:32px;
        font-weight:700;
        margin-bottom:4px;
        text-shadow:2px 2px 10px rgba(0,0,0,0.3);
    }
    .subtitle { font-size:15px; opacity:0.9; }

    .leaderboard {
        flex:1;
        display:grid;
        grid-template-columns:repeat(2, minmax(0,1fr));
        gap:16px;
        max-width:1200px;
        width:100%;
        margin-inline:auto;
    }

    .house-card {
        position:relative;
        background:rgba(255,255,255,0.95);
        border-radius:16px;
        padding:20px;
        box-shadow:0 10px 30px rgba(0,0,0,0.35);
        display:flex;
        flex-direction:column;
        justify-content:space-between;
        transition:transform .3s ease, box-shadow .3s ease;
        animation:slideIn .8s ease;
        overflow:hidden;
        min-height:180px;
    }
    .house-card:hover {
        transform:translateY(-3px);
        box-shadow:0 14px 40px rgba(0,0,0,0.45);
    }

    /* Winner glow (1st place) */
    .house-card.winner {
        border:3px solid #ffd700;
        box-shadow:0 0 25px rgba(255,215,0,0.7);
    }
    .house-card.winner::before {
        content:"";
        position:absolute;
        inset:-40%;
        background:radial-gradient(circle, rgba(255,255,255,0.35) 0%, transparent 60%);
        opacity:0.7;
        pointer-events:none;
        animation:winnerGlow 3s infinite ease-in-out;
    }

    .house-header {
        display:flex;
        align-items:center;
        justify-content:space-between;
        z-index:1;
        position:relative;
    }
    .house-info {
        display:flex;
        align-items:center;
        gap:12px;
    }
    .house-icon { font-size:46px; animation:bounceIcon 2.2s infinite; }
    .house-name { font-size:30px; font-weight:800; letter-spacing:0.5px; }

    .rank-badge {
        background:#102d69;
        color:white;
        width:48px;
        height:48px;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        font-size:17px;
        font-weight:700;
        box-shadow:0 5px 15px rgba(0,0,0,0.3);
    }
    .rank-badge.gold {
        background:conic-gradient(from 30deg,#fff6b0,#ffd700,#ffed4e,#fff6b0);
        color:#102d69;
        animation:pulse 2.4s infinite;
    }

    .points-wrapper {
        position:relative;
        text-align:center;
        margin-top:14px;
        padding:8px 0 4px;
    }
    .points-background-ring {
        position:absolute;
        inset:5px 20%;
        border-radius:999px;
        background:radial-gradient(circle, rgba(255,215,0,0.25) 0%, transparent 70%);
        opacity:0;
        transition:opacity .3s;
    }
    .house-card.winner .points-background-ring {
        opacity:1;
    }

    .points {
        position:relative;
        font-size:64px;
        font-weight:900;
        color:#102d69;
        text-shadow:0 3px 12px rgba(0,0,0,0.25);
        display:inline-block;
        z-index:1;
    }
    .points.pop {
        animation:slowPop 1.2s ease-out;
    }

    .phoenix .house-name { color:#ff4444; }
    .dragon  .house-name { color:#44aa44; }
    .hydra   .house-name { color:#4488ff; }
    .griffin .house-name { color:#ffaa00; }

    .last-updated {
        text-align:center;
        font-size:13px;
        opacity:0.9;
        margin-top:10px;
        text-shadow:0 2px 6px rgba(0,0,0,0.4);
    }

    /* Keyframes */
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
    @keyframes slideIn { from{opacity:0; transform:translateX(-40px);} to{opacity:1; transform:translateX(0);} }
    @keyframes bounceIcon {
        0%,100%{transform:translateY(0);}
        50%{transform:translateY(-6px);}
    }
    @keyframes pulse {
        0%,100%{transform:scale(1);}
        50%{transform:scale(1.08);}
    }
    @keyframes winnerGlow {
        0%,100%{opacity:0.5; transform:scale(1);}
        50%{opacity:1; transform:scale(1.1);}
    }
    @keyframes slowPop {
        0%   { transform:scale(1); }
        25%  { transform:scale(1.35); }
        55%  { transform:scale(1.5) rotate(1deg); }
        85%  { transform:scale(1.25); }
        100% { transform:scale(1); }
    }

    @media(max-width:1024px){
        .leaderboard {
            grid-template-columns:1fr;
        }
        body {
            padding:12px;
        }
        .points {
            font-size:52px;
        }
    }
</style>
</head>
<body>

<div class="header">
    <img src="https://raw.githubusercontent.com/iesv-swe/IESV-Now-and-Next/main/logo.png" class="logo" alt="IESV Logo">
    <div>
        <h1>House Points Leaderboard</h1>
        <p class="subtitle">Live Rankings</p>
    </div>
</div>

<div class="leaderboard" id="leaderboard"></div>
<div class="last-updated" id="lastUpdated">Loading data...</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec?action=houseTotals";

const houseIcons = { Phoenix:'ðŸ”¥', Dragon:'ðŸ‰', Hydra:'ðŸŒŠ', Griffin:'ðŸ¦…' };
const houseColors = { Phoenix:'phoenix', Dragon:'dragon', Hydra:'hydra', Griffin:'griffin' };

async function loadLeaderboard() {
    try {
        const r = await fetch(API);
        const j = await r.json();
        if (j.status !== "success") throw new Error("Bad response");
        const houses = j.data.houses.sort((a,b)=>a.rank-b.rank);
        renderHouses(houses);
        document.getElementById('lastUpdated').textContent =
            `Last updated: ${new Date().toLocaleString()}`;
    } catch (e) {
        document.getElementById('lastUpdated').textContent =
            "Error loading leaderboard.";
        console.error(e);
    }
}

function renderHouses(houses) {
    const container = document.getElementById("leaderboard");
    container.innerHTML = "";

    houses.forEach(h => {
        const ord = h.rank===1?'1st':h.rank===2?'2nd':h.rank===3?'3rd':'4th';
        const rankClass = h.rank===1 ? 'gold' : '';
        const houseClass = houseColors[h.house] || '';
        const winnerClass = h.rank===1 ? 'winner' : '';

        container.innerHTML += `
        <div class="house-card ${houseClass} ${winnerClass}">
            <div class="house-header">
                <div class="house-info">
                    <div class="house-icon">${houseIcons[h.house] || ''}</div>
                    <div class="house-name">${h.house}</div>
                </div>
                <div class="rank-badge ${rankClass}">${ord}</div>
            </div>
            <div class="points-wrapper">
                <div class="points-background-ring"></div>
                <div class="points" data-rank="${h.rank}">${h.totalPoints}</div>
            </div>
        </div>`;
    });

    animateWinner();
}

function animateWinner() {
    const winnerPoints = document.querySelector('.points[data-rank="1"]');
    if (!winnerPoints) return;

    winnerPoints.classList.remove('pop');
    void winnerPoints.offsetWidth; // reset animation
    winnerPoints.classList.add('pop');

    setTimeout(() => {
        winnerPoints.classList.remove('pop');
    }, 1300);
}

loadLeaderboard();
setInterval(loadLeaderboard, 30000);
</script>

</body>
</html>
