<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Points Leaderboard - IESV</title>
<link rel="icon" type="image/x-icon" href="leaderboard-favicon.ico">
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
        background:linear-gradient(135deg,#102d69 0%,#00a0df 100%);
        height:100vh; display:flex; flex-direction:column;
        padding:20px; color:white; overflow:hidden;
    }
    .header { display:flex; align-items:center; gap:20px; margin-bottom:20px;
        animation:fadeIn 1s ease; max-width:1400px; margin-inline:auto; }
    .logo { width:72px; filter:brightness(0) invert(1); }
    h1 { font-size:36px; font-weight:700; margin-bottom:5px;
        text-shadow:2px 2px 10px rgba(0,0,0,0.3); }
    .subtitle { font-size:16px; opacity:0.9; }

    .leaderboard {
        flex:1; display:grid; grid-template-columns:repeat(2,1fr);
        grid-gap:15px; max-width:1400px; width:100%; margin-inline:auto;
    }

    .house-card {
        background:rgba(255,255,255,0.95); border-radius:15px; padding:25px;
        box-shadow:0 10px 40px rgba(0,0,0,0.3);
        display:flex; flex-direction:column; justify-content:space-between;
        transition:.4s ease; animation:slideIn .8s ease; position:relative;
        overflow:hidden;
    }
    .house-card.rank-1 { border:4px solid gold; }
    .house-card:hover { transform:translateY(-3px);
        box-shadow:0 15px 50px rgba(0,0,0,0.4); }

    .house-header { display:flex; align-items:center; justify-content:space-between; }
    .house-info { display:flex; align-items:center; gap:15px; }
    .house-icon { font-size:60px; animation:bounceIcon 2s infinite; }
    .house-name { font-size:42px; font-weight:700; }

    .rank-badge {
        background:#102d69; color:white; width:55px; height:55px;
        border-radius:50%; display:flex; align-items:center;
        justify-content:center; font-size:20px; font-weight:700;
        box-shadow:0 5px 15px rgba(0,0,0,0.3);
    }
    .rank-badge.gold { background:linear-gradient(135deg,#ffd700,#ffed4e);
        color:#102d69; animation:pulse 2s infinite; }

    /* ðŸŒŸ TWINKLES BEHIND POINTS */
    .points-wrapper {
        position:relative; text-align:center; margin-top:20px;
    }
    .twinkle {
        position:absolute; width:10px; height:10px; background:white;
        border-radius:50%; opacity:0.8; filter:blur(1px);
        animation:twinkle 2s infinite ease-in-out;
    }
    @keyframes twinkle {
        0%,100%{opacity:0; transform:scale(0.4);}
        50%{opacity:1; transform:scale(1.3);}
    }

    /* âœ¨ SPARKLES ON POP */
    .sparkle {
        position:absolute; width:8px; height:8px; border-radius:50%;
        pointer-events:none; background:yellow; filter:blur(1px);
        animation:spark 0.8s ease-out forwards;
    }
    @keyframes spark {
        from { transform:scale(1) translate(0,0); opacity:1; }
        to { transform:scale(0.2) translate(40px,-40px); opacity:0; }
    }

    /* ðŸŽ‰ Dramatic Pop Animation */
    .points {
        font-size:90px; font-weight:900; color:#102d69;
        text-shadow:0 3px 10px rgba(0,0,0,0.2);
        display:inline-block;
    }
    .points.pop {
        animation:slowPop 1.2s ease-out;
    }
    @keyframes slowPop {
        0%   { transform:scale(1); }
        20%  { transform:scale(1.4); }
        50%  { transform:scale(1.55) rotate(2deg); }
        80%  { transform:scale(1.3); }
        100% { transform:scale(1); }
    }

    .phoenix .house-name { color:#ff4444; }
    .dragon .house-name { color:#44aa44; }
    .hydra .house-name { color:#4488ff; }
    .griffin .house-name { color:#ffaa00; }

    .last-updated { text-align:center; font-size:13px; opacity:0.85; margin-top:10px; }

    @keyframes slideIn { from{opacity:0; transform:translateX(-50px);} to{opacity:1; transform:translateX(0);} }
    @keyframes bounceIcon { 0%,100%{transform:translateY(0);}50%{transform:translateY(-9px);} }
    @keyframes pulse { 0%,100%{transform:scale(1);}50%{transform:scale(1.1);} }

    @media(max-width:1024px){
        .leaderboard { grid-template-columns:1fr; }
        body { height:auto; overflow:auto; }
        .points { font-size:65px; }
    }
</style>
</head>
<body>

<div class="header">
    <img src="https://raw.githubusercontent.com/iesv-swe/IESV-Now-and-Next/main/logo.png" class="logo">
    <div>
        <h1>House Points Leaderboard</h1>
        <p class="subtitle">Live Rankings</p>
    </div>
</div>

<div class="leaderboard" id="leaderboard"></div>
<div class="last-updated" id="lastUpdated">Loading data...</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec?action=houseTotals";

const houseIcons = { Phoenix:'ðŸ”¥', Dragon:'ðŸ‰', Hydra:'ðŸŒŠ', Griffin:'ðŸ¦…' };
const houseColors = { Phoenix:'phoenix', Dragon:'dragon', Hydra:'hydra', Griffin:'griffin' };

async function loadLeaderboard() {
    try {
        const r = await fetch(API);
        const j = await r.json();
        if (j.status !== "success") throw "Bad response";
        const houses = j.data.houses.sort((a,b)=>a.rank-b.rank);
        displayLeaderboard(houses);
        document.getElementById('lastUpdated').textContent =
            `Last updated: ${new Date().toLocaleString()}`;
    } catch {
        document.getElementById('lastUpdated').textContent =
            "Error loading leaderboard.";
    }
}

function displayLeaderboard(houses) {
    const div = document.getElementById("leaderboard");
    div.innerHTML = "";

    houses.forEach(h => {
        const ord = h.rank===1?'1st':h.rank===2?'2nd':h.rank===3?'3rd':'4th';
        const rankClass = h.rank===1?'gold':'';
        const cardClass = h.rank===1?'rank-1':'';

        div.innerHTML += `
        <div class="house-card ${houseColors[h.house]} ${cardClass}">
            <div class="house-header">
                <div class="house-info">
                    <div class="house-icon">${houseIcons[h.house]}</div>
                    <div class="house-name">${h.house}</div>
                </div>
                <div class="rank-badge ${rankClass}">${ord}</div>
            </div>
            <div class="points-wrapper">
                <div class="points" id="pts-${h.house}">${h.totalPoints}</div>
            </div>
        </div>`;
    });

    animatePoints();
    twinkleStars();
}

function twinkleStars() {
    document.querySelectorAll(".points-wrapper").forEach(wrapper => {
        wrapper.querySelectorAll(".twinkle").forEach(e=>e.remove());
        for (let i = 0; i < 6; i++) {
            const t = document.createElement("div");
            t.className = "twinkle";
            t.style.left = `${20 + Math.random()*60}%`;
            t.style.top = `${10 + Math.random()*60}%`;
            t.style.animationDelay = `${Math.random()*2}s`;
            wrapper.appendChild(t);
        }
    });
}

function animatePoints() {
    document.querySelectorAll(".points").forEach(p => {
        p.classList.remove("pop");
        void p.offsetWidth;
        p.classList.add("pop");

        for (let i=0;i<4;i++){
            const s=document.createElement("div");
            s.className="sparkle";
            s.style.left=`${50+Math.random()*30-15}%`;
            s.style.top=`${40+Math.random()*30-15}%`;
            p.parentElement.appendChild(s);
            setTimeout(()=>s.remove(),800);
        }
    });
}

loadLeaderboard();
setInterval(loadLeaderboard, 30000);
</script>

</body>
</html>
