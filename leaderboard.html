<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>House Points Leaderboard - IESV</title>
<link rel="icon" type="image/x-icon" href="leaderboard-favicon.ico">

<style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background:url('stone.png') repeat;
        background-size:600px;
        min-height:100vh;
        display:flex;
        flex-direction:column;
        padding:20px;
        color:white;
        overflow:hidden;
    }

    /* HEADER */
    .header {
        display:flex; align-items:center; gap:15px;
        margin-bottom:14px; text-shadow:0 3px 10px black;
    }

    .logo { width:70px; filter:brightness(0) invert(1); }

    h1 { font-size:38px; font-weight:800; margin-bottom:2px; }
    .subtitle { font-size:16px; opacity:0.9; margin-top:-4px; }

    /* GRID LAYOUT */
    .leaderboard {
        display:grid;
        grid-template-columns:1fr;
        grid-template-rows:auto auto;
        gap:16px;
        height:calc(100vh - 140px);
    }

    .winner-row {
        display:flex;
        justify-content:center;
        align-items:center;
    }

    .bottom-row {
        display:grid;
        grid-template-columns:repeat(3,1fr);
        gap:16px;
    }

    /* CARDS */
    .house-card {
        background:rgba(0,0,0,0.55);
        border-radius:22px;
        padding:14px;
        box-shadow:0 8px 28px rgba(0,0,0,0.65);
        border:2px solid rgba(255,255,255,0.06);
        backdrop-filter:blur(6px);
        display:flex;
        flex-direction:column;
        align-items:center;
        justify-content:flex-start;
        position:relative;
        cursor:pointer;
        overflow:hidden;
    }

    .house-card:hover {
        transform:translateY(-3px);
        transition:0.25s;
    }

    /* WINNER CARD */
    .winner-card {
        width:100%;
        max-width:1400px;
        min-height:200px;
        max-height:210px;
        padding-top:12px;
        border:3px solid rgba(255,170,40,1);
        animation:winnerGlow 3.5s ease-in-out infinite;
    }

    @keyframes winnerGlow {
        0%,100% {
            box-shadow:
               0 0 22px rgba(255,150,0,0.9),
               0 0 44px rgba(255,120,0,0.7),
               inset 0 0 18px rgba(255,120,0,0.4);
        }
        50% {
            box-shadow:
               0 0 38px rgba(255,180,0,1),
               0 0 72px rgba(255,140,0,0.8),
               inset 0 0 28px rgba(255,140,0,0.6);
        }
    }

    /* RANK BADGES */
    .rank {
        position:absolute;
        top:10px; right:10px;
        width:58px; height:58px;
        border-radius:50%;
        display:flex; align-items:center; justify-content:center;
        font-weight:700; font-size:18px;
        border:2px solid rgba(255,255,255,0.25);
        background:rgba(0,0,0,0.4);
    }

    .gold   { background:linear-gradient(135deg,#ffd700,#ffae00); color:black; }
    .silver { background:linear-gradient(135deg,#d4d4d4,#f7f7f7); color:black; }
    .bronze { background:linear-gradient(135deg,#cd7f32,#e2a46e); color:black; }

    /* CRESTS */
    .crest {
        width:60px;
        max-width:60px;
        margin-top:6px;
        margin-bottom:4px;
    }

    .bottom-row .crest {
        width:55px;
        max-width:55px;
        margin-bottom:4px;
        margin-top:8px;
    }

    /* BIG NUMBERS */
    .points {
        font-size:clamp(70px, 13vw, 170px);
        font-weight:900;
        text-shadow:0 6px 22px rgba(0,0,0,0.9);
        margin:0;
        line-height:1;
        margin-top:auto;
    }

    .winner-card .points {
        font-size:clamp(80px, 15vw, 170px);
        color:#ffdd77;
        text-shadow:
            0 0 12px rgba(255,200,50,1),
            0 0 26px rgba(255,160,0,1),
            0 0 44px rgba(255,120,0,1),
            0 0 60px rgba(255,90,0,1);
        animation:winnerNumber 2.2s infinite ease-in-out;
    }

    @keyframes winnerNumber {
        0%,100% { opacity:1; transform:scale(1); }
        45% { opacity:0.92; transform:scale(1.03); }
        50% { opacity:1; transform:scale(1.05); }
        55% { opacity:0.93; transform:scale(1.02); }
    }

    /* FOOTER */
    .last-updated {
        text-align:center;
        opacity:0.85;
        font-size:12px;
        margin-top:4px;
    }
</style>
</head>
<body>

<div class="header">
    <img src="https://raw.githubusercontent.com/iesv-swe/IESV-Now-and-Next/main/logo.png" class="logo">
    <div>
        <h1>House Points Leaderboard</h1>
        <p class="subtitle">Live Rankings</p>
    </div>
</div>

<div class="leaderboard">
    <div class="winner-row" id="winnerRow"></div>
    <div class="bottom-row" id="bottomRow"></div>
</div>

<div class="last-updated" id="lastUpdated">Loading data...</div>

<script>
const API =
 "https://script.google.com/macros/s/AKfycbyZkszKyoadMXT4fXahoNm3hqn6wj_pBscUjt0bt2gHOSnLaFyTJGEn9032liVRaqH3lQ/exec?action=houseTotals";

const shields = {
    Phoenix:"phoenix2-removebg.png",
    Dragon:"dragon2-removebg.png",
    Hydra:"hydra2-removebg.png",
    Griffin:"griffin2-removebg.png"
};

function roundScore(n){ return Math.round(parseFloat(n)); }

async function loadLeaderboard() {
    try {
        const res = await fetch(API);
        const json = await res.json();
        if (json.status !== "success") throw new Error("Bad API");

        const houses = json.data.houses.slice().sort((a,b)=>a.rank-b.rank);

        render(houses);
        document.getElementById("lastUpdated").textContent =
            "Last updated: " + new Date().toLocaleString();

    } catch(err) {
        document.getElementById("lastUpdated").textContent = "Error loading.";
        console.error(err);
    }
}

function render(houses){
    const winner = houses[0];
    const losers = houses.slice(1,4);

    const winnerRow = document.getElementById("winnerRow");
    const bottomRow = document.getElementById("bottomRow");

    winnerRow.innerHTML="";
    bottomRow.innerHTML="";

    /* WINNER CARD */
    const winnerCard = document.createElement("div");
    winnerCard.className="house-card winner-card";
    winnerCard.onclick = ()=>window.location.href=`house-page.html?house=${winner.house.toLowerCase()}`;
    winnerCard.innerHTML = `
        <div class="rank gold">1st</div>
        <img class="crest" src="${shields[winner.house]}">
        <div class="points">${roundScore(winner.houseScore)}</div>
    `;
    winnerRow.appendChild(winnerCard);

    /* 2ndâ€“4th */
    losers.forEach(x=>{
        const rankClass =
            x.rank===2?"silver":
            x.rank===3?"bronze":"";

        const card=document.createElement("div");
        card.className="house-card";
        card.onclick=()=>window.location.href=`house-page.html?house=${x.house.toLowerCase()}`;
        card.innerHTML=`
            <div class="rank ${rankClass}">
                ${x.rank}${x.rank===2?"nd":x.rank===3?"rd":"th"}
            </div>
            <img class="crest" src="${shields[x.house]}">
            <div class="points">${roundScore(x.houseScore)}</div>
        `;
        bottomRow.appendChild(card);
    });
}

loadLeaderboard();
setInterval(loadLeaderboard,30000);
</script>

</body>
</html>
